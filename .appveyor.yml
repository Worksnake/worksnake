skip_tags: false
skip_non_tags: true

image:
  - Visual Studio 2019
  - Ubuntu
  - macOS

platform:
  - x86
  - x64

#NPM Doesn't seem to like caching, requires investigation
#cache:
#  - node_modules

init:
  - git config --global core.autocrlf input
  
for:
  -
    matrix:
      only:
        - image: Visual Studio 2019
          platform: x86
    install:
        - ps: Install-Product node 14 x64
        - npm ci
    build_script:
      - npm run make:32
  -
    matrix:
      only:
        - image: Visual Studio 2019
          platform: x64
    install:
        - ps: Install-Product node 14 x64
        - npm ci
    build_script:
      - npm run make
  -
    matrix:
      only:
        - image: Ubuntu
          platform: x86
    install:
      - nvm install 14
      - npm ci
      - apt-get install dpkg fakeroot -y
    build_script:
      - npm run make:32
  -
    matrix:
      only:
        - image: Ubuntu
          platform: x64
    install:
      - nvm install 14
      - npm ci
      - apt-get install dpkg fakeroot -y
    build_script:
      - npm run make
  -
    matrix:
      only:
        - image: macOS
          platform: x86
    install:
      - nvm install 14
      - npm ci
    build_script:
      - npm run make:32
  -
    matrix:
      only:
        - image: macOS
          platform: x64
    install:
      - nvm install 14
      - npm ci
    build_script:
      - npm run make

test: false

artifacts:
  - path: out/make/**/*

#Disabled until I manage to fix this
#deploy:
#  repository: Worksnake/worksnake-releases
#  release: RENAME
#  description: FillIn
#  provider: Github
#  auth_token:
#    secure: 5tEqSzM/9afOkovJUSyOrOGkIjjwZcbvt6di82NYWOaCiX/pJNm0u+OjMaT7yh9v
#  artifact: out/make/**/*
#  draft: true
#  prerelease: false