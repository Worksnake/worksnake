<head>
    <script>
        var cancelled = false
    </script>
    <script>
        function buttonClose() {

            /*window.innerWidth = 0;
            window.innerHeight = 0;*/

            cancelled = true

            require('electron').ipcRenderer.send('hide', id)

            setTimeout(() => {
                require('electron').ipcRenderer.send('show', id)
                start()
            }, cancel * 1000)

            //window.close()
        }
    </script>
    <script>
        function handleClose() {
            require('electron').ipcRenderer.send('popup', {
                interval: interval,
                time: time,
                cancel: cancel,
                cancelable: cancelable
            })
        }
    </script>
    <script>
        function forceClose() {
            handleClose()
            window.close()
        }
    </script>
</head>
<body style="overflow: hidden;">
    <p id="text"></p>
    <script>
        {
            const el = document.getElementById('text')
            el.innerHTML = `${interval / 60}/${time} break!`
        }
    </script>
    <div style="width: 80vw; border-color: black; border-width: 3px; border-style: solid; height: 25px; margin-left: auto; margin-right: auto;">
        <div id="timeLeft" style="height: 25px; width: 0%; background-color: rgb(43, 170, 43); text-align: center;"></div>
        <div id="timeLeftText" style="text-align: center; position: relative; line-height: 25px; bottom: 25px;"></div>
    </div>
    <script>
        function start() {

            cancelled = false

            const el = document.getElementById('timeLeft')
            const el2 = document.getElementById('timeLeftText')

            var t = time - 1

            el2.innerHTML = `${t + 1} seconds left`
            el.style.width = `${100 - Math.floor(100 / time * t)}%`

            const task = setInterval(() => {
                el2.innerHTML = `${t} seconds left`
                el.style.width = `${100 - Math.floor(100 / time * t)}%`

                if(cancelled) {
                    el.innerHTML = `Cancelled`
                    
                    clearInterval(task)
                    clearInterval(task2)
                }

                if(t < 1) {
                    handleClose()
                    window.close()
                }

                t--
            }, 1000)

            var prev

            const task2 = setInterval(() => {
                const cursorScreenPoint = require('electron').remote.screen.getCursorScreenPoint()

                if(!prev) {
                    prev = cursorScreenPoint
                    return
                }

                if(cursorScreenPoint.x !== prev.x || cursorScreenPoint.y !== prev.y) {
                    t = time
                    el2.innerHTML = `${t} seconds left`
                    el.style.width = `${100 - Math.floor(100 / time * t)}%`
                }

                prev = cursorScreenPoint
            }, 100)
        }
    </script>
    <script>
        start()
    </script>
    <button onclick="buttonClose()">Snooze</button>
    <script>
        if(cancelable) {
            const btn = document.createElement('button')
            btn.innerText = 'Cancel'
            btn.onclick = forceClose

            document.body.appendChild(btn)
        }
    </script>
</body>